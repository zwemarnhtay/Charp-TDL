@page "/task"
@attribute [Authorize]
@inject TaskService taskService
@inject IJSRuntime jsRuntime

<h3>TaskPage</h3>

<TaskCreatePage></TaskCreatePage>

@if(taskList is not null)
{
    <table class="table table-hover mb-0 mt-3">
        <thead>
            <tr>
                <th scope="col">Team Member</th>
                <th scope="col">Task</th>
                <th scope="col">Deadline</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var task in taskList)
            {
                <tr>
                  <td>

                  </td>
                  <td class="align-middle">
                    @task.Title
                  </td>
                  <td class="align-middle">
                    @task.Deadline
                  </td>
                    <td class="align-middle">
                        <a href="#!" data-mdb-tooltip-init title="Done" @onclick="() => Complete(task.Id)">
                            <i class="fas fa-check fa-lg text-success me-3"></i>
                        </a>
                        <a href="#!" data-mdb-tooltip-init title="Remove">
                            <i class="fas fa-trash-alt fa-lg text-warning"></i>
                        </a>
                    </td>
                </tr>
            }
        @*     <tr class="fw-normal">
                <th>
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava1-bg.webp"
                         alt="avatar 1" style="width: 45px; height: auto;">
                    <span class="ms-2">Alice Mayer</span>
                </th>
                <td class="align-middle">
                    <span>Call Sam For payments</span>
                </td>
                <td class="align-middle">
                    <h6 class="mb-0"><span class="badge bg-danger">High priority</span></h6>
                </td>
                <td class="align-middle">
                    <a href="#!" data-mdb-tooltip-init title="Done">
                        <i class="fas fa-check fa-lg text-success me-3"></i>
                    </a>
                    <a href="#!" data-mdb-tooltip-init title="Remove">
                        <i class="fas fa-trash-alt fa-lg text-warning"></i>
                    </a>
                </td>
            </tr>
            <tr class="fw-normal">
                <th>
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava2-bg.webp"
                         alt="avatar 1" style="width: 45px; height: auto;">
                    <span class="ms-2">Kate Moss</span>
                </th>
                <td class="align-middle">Make payment to Bluedart</td>
                <td class="align-middle">
                    <h6 class="mb-0"><span class="badge bg-success">Low priority</span></h6>
                </td>
                <td class="align-middle">
                    <a href="#!" data-mdb-tooltip-init title="Done">
                        <i class="fas fa-check fa-lg text-success me-3"></i>
                    </a>
                    <a href="#!" data-mdb-tooltip-init title="Remove">
                        <i class="fas fa-trash-alt fa-lg text-warning"></i>
                    </a>
                </td>
            </tr>
            <tr class="fw-normal">
                <th>
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"
                         alt="avatar 1" style="width: 45px; height: auto;">
                    <span class="ms-2">Danny McChain</span>
                </th>
                <td class="align-middle">Office rent</td>
                <td class="align-middle">
                    <h6 class="mb-0"><span class="badge bg-warning">Middle priority</span></h6>
                </td>
                <td class="align-middle">
                    <a href="#!" data-mdb-tooltip-init title="Done">
                        <i class="fas fa-check fa-lg text-success me-3"></i>
                    </a>
                    <a href="#!" data-mdb-tooltip-init title="Remove">
                        <i class="fas fa-trash-alt fa-lg text-warning"></i>
                    </a>
                </td>
            </tr>
            <tr class="fw-normal">
                <th>
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava5-bg.webp"
                         alt="avatar 1" style="width: 45px; height: auto;">
                    <span class="ms-2">Alexa Chung</span>
                </th>
                <td class="align-middle">Office grocery shopping</td>
                <td class="align-middle">
                    <h6 class="mb-0"><span class="badge bg-danger">High priority</span></h6>
                </td>
                <td class="align-middle">
                    <a href="#!" data-mdb-tooltip-init title="Done">
                        <i class="fas fa-check fa-lg text-success me-3"></i>
                    </a>
                    <a href="#!" data-mdb-tooltip-init title="Remove">
                        <i class="fas fa-trash-alt fa-lg text-warning"></i>
                    </a>
                </td>
            </tr>
            <tr class="fw-normal">
                <th class="border-0">
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava6-bg.webp"
                         alt="avatar 1" style="width: 45px; height: auto;">
                    <span class="ms-2">Ben Smith</span>
                </th>
                <td class="border-0 align-middle">Ask for Lunch to Clients</td>
                <td class="border-0 align-middle">
                    <h6 class="mb-0"><span class="badge bg-success">Low priority</span></h6>
                </td>
                <td class="border-0 align-middle">
                    <a href="#!" data-mdb-tooltip-init title="Done">
                        <i class="fas fa-check fa-lg text-success me-3"></i>
                    </a>
                    <a href="#!" data-mdb-tooltip-init title="Remove">
                        <i class="fas fa-trash-alt fa-lg text-warning"></i>
                    </a>
                </td>
            </tr> *@
        </tbody>
    </table>
}

@code {
    private List<TaskModel>? taskList = null;

    protected override async Task OnInitializedAsync()
    {
        await List();
    }

    private async Task List()
    {
        taskList = await taskService.GetTaskListById();
        Console.WriteLine(taskList);
    }

    private async Task Complete(string taskId)
    {
        var message = await taskService.CompleteTaskAsync(taskId);

        if (message == null) return;

        await jsRuntime.InvokeVoidAsync("alert", message);
    }
}
